<!DOCTYPE html>
<html>
<head>
  <title>Colorgy Table - 提醒你上課的好幫手</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <%= stylesheet_link_tag 'application', media: 'all' %>
  <%= javascript_include_tag 'application' %>
  <%= csrf_meta_tags %>
  <%= favicon_link_tag 'favicon.png' %>
  <% if @user && @user.simulator_image_url %>
    <meta property="og:image" content="<%= @user && @user.simulator_image_url %>"/>
  <% else %>
    <meta property="og:image" content="<%= image_path('table-img.png') %>"/>
  <% end %>
  <meta property="og:title" content="我的 Colorgy Table 上課從此變得更有樂趣" />
  <meta property="og:type" content="article">
  <meta property="og:description" content="<%= @user && @user.name %>上 Colorgy Table 安排課表，認識更多同班同學，馬上變成排課達人！" />
  <meta property="og:url" content="<%= "https://#{request.host}#{request.fullpath}" %>" />
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet">
  <script src='https://code.createjs.com/createjs-2015.05.21.min.js'></script>
</head>
<body>
<div id="fb-root"></div>
  <script>
    window.fbAsyncInit = function() {
      FB.init({
        appId      : '752440461479659',
        xfbml      : true,
        version    : 'v2.3'
      });
      <% if !current_user.blank? %>
        FB.Event.subscribe('edge.create', page_like_callback);
      <% end %>
    };

    (function(d, s, id){
       var js, fjs = d.getElementsByTagName(s)[0];
       if (d.getElementById(id)) {return;}
       js = d.createElement(s); js.id = id;
       js.src = "//connect.facebook.net/zh_TW/sdk.js";
       fjs.parentNode.insertBefore(js, fjs);
     }(document, 'script', 'facebook-jssdk'));

    var page_like_callback = function(url, html_element) {
      $.ajax({
        method: 'POST',
        url: '/user_subscribed',
        dataType: 'json'
      });
    }

    // In your onload handler
    
  </script>
<%= render 'partials/navbar' %>
<%= render 'partials/flash_messages' %>
<% if !current_user.blank? %>
  <% if current_user.first_login == true %>
  <div class="celebration-container">
    <a class="celebration-close hide"><i class="material-icons" style="color: #fff; font-size: 40px !important;">close</i></a>
    <canvas id="fireworks"></canvas>
    <div class="page1 active">
      <div class="celebration-text">
        <h3 class="title">恭喜你獲得 50 元 Colorgy 購物金!</h3>
        <p class="description">首次進入 Colorgy 的你，我們準備了 50 元的購物金，您可以在 8月15號 到 8月 31號 期間，前往 Colorgy Books 使用，一次買齊上課所需的教科書及用品，為即將到來的開學做好滿滿的準備！</p>
        <a class="btn btn--large" id="go-to-page2">下一步</a>
      </div>
    </div>
    <div class="page2">
      <div class="celebration-text">
        <h3 class="title">分享按讚再獲得 50 元購物金！</h3>
        <p class="description">現在就分享 Colorgy ， 讓更多同學一起來選課找同學，體驗全新大學生活！</p>
        <p><div class="fb-page" data-href="https://www.facebook.com/pages/Colorgy/1529686803975150" data-small-header="true" data-adapt-container-width="true" data-hide-cover="true" data-show-facepile="true" data-show-posts="false"></div></p>
        <a class="fb-share-table-btn" id="fb-share-table-btn">分享到 Facebook</a>
      </div>
    </div>
    <div class="page3">
      <div class="celebration-text">
        <h3 class="title">恭喜你獲得全部共 100元的 Colorgy 購物金！</h3>
        <p class="description">Colorgy 團隊將會在 Colorgy Books 開通時第一時間 Mail 及 簡訊 通知同學前往使用！<br>現在，就盡情享受新的大學生活吧！Color Your College!</p>
        <a class="btn btn--large" id="close-celebration-btn">開始進入 Table</a>
      </div>
    </div>
  </div>
  <script type="text/javascript">
    $.ajax({
      method: 'POST',
      url: '/user_first_login',
      dataType: 'json'
    });

    $('#go-to-page2').click(function(){
      $('.celebration-container .page1').removeClass('active');
      $('.celebration-container .page2').addClass('active');
      $('.celebration-close').removeClass('hide');
    })
    $('#close-celebration-btn').click(function(){
      $('.celebration-container').addClass('hide');
      $('.celebration-container').remove();
    })
    $('.celebration-close').click(function(){
      $('.celebration-container').addClass('hide');
      $('.celebration-container').remove();
    })
    $('.fb-share-table-btn').click(function(){
      init_share_table();
    })
    function init_share_table() {
      _origin = "https://table.colorgy.io";

      FB.ui(
        {
          method: 'share',
          href: _origin,
        },
        // callback
        function(response) {
          if (response && !response.error_code) {
            $('.celebration-container .page2').removeClass('active');
            $('.celebration-container .page3').addClass('active');
            $.ajax({
              method: 'POST',
              url: '/user_shared',
              dataType: 'json'
            });
          } else {
            flash.error('分享失敗！請再試一次');
          }
        }
      );
    }
  </script>
  <% end %>
<% end %>
<div class="preloader-wrapper" id="perloader-wrapper">
  <div class="spinner-layer spinner-red-only">
    <div class="circle-clipper left">
      <div class="circle"></div>
    </div><div class="gap-patch">
      <div class="circle"></div>
    </div><div class="circle-clipper right">
      <div class="circle"></div>
    </div>
  </div>
</div>
<div class="wrapper" id="wrapper">
  <%= yield %>
</div>

<%= render 'partials/google_analytics' %>
<%= render 'partials/footer' %>
<%= javascript_include_tag 'replace_error_image_url' %>
<%= javascript_include_tag 'fireworks' %>
<script type="text/javascript">
if($('#fireworks').length){
  fireworks();
}
</script>
</body>
</html>
